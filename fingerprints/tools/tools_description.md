# Описание технической реализации классов

## class FingerMatcher

`fingerprints/tools/matcher/identification.py`

### Зависимости

Библиотеки `Suprema UFMatcher` разработаны на языке С. В зависимости от 
операционной системы используются разные библиотеки. Выбор библиотеки для импорта 
происходит автоматически в зависимости от типа операционной системы
(см. подробнее в `matcher/imports.py`)

### Особенности использования

Документация к SDK находится в файле **"BioMini SDK for Windows Programming Manual"**.
 Однако SDK доступна для **С/C++**, **C#**, **Java**.

Для использования функционала библиотек используются `ctypes`. 
Это библиотека внешних функций для Python. Она предоставляет типы данных, 
совместимые с C, и позволяет вызывать функции в библиотеках DLL или совместно 
используемых библиотеках.

Описание всех параметров и доступных значений представлено в вышеуказанном файле.

### Создание объекта класса

**Создание h_matcher**

Для успешного использования функций библиотеки необходимо создать объект `h_matcher`. 
Для этого вызывается приватный метод `_get_matcher()`, реализующий метод 
`ufm_lib.UFM_Create()`, в который передается указатель на void переменную `h_mathcer`.

В процессе проверяется наличие лицензии на использование библиотеки. Необходимо 
убедиться, что сканер `Suprema BioMini` физически подключен по USB.

**Установка формата Template**

Библиотеки поддерживают 3 формата хранения информации об отпечатке:
- Suprema template type
- ISO template type
- ANSI378 template type

По умолчанию используется ISO template type, т.к. именно такой формат доступен 
на устройстве Suprema RealScan-G10.

Реализуется метод `ufm_lib.UFM_SetTemplateType()`. В качестве аргументов передаются 
`h_mathcer` и тип Template.

**Установка дополнительных параметров**

Реализуется метод `ufm_lib.UFM_SetParameter()`. В качестве аргуметов передаются
`h_mathcer`, `code` параметра и указатель на значение `value`


### Метод `identify(target_template, templates)`

Аргументы:
- **target_template:** Template целевого отпечатка, по которому будет происходить идентификация.
- **templates:** массив Template, с которыми будет сравниваться целевой отпечаток.

Реализуется метод `ufm_lib.UFM_Identify()`. В качестве аргументов передаются:
- **h_matcher:** атрибут объекта класса `FingerMatcher`.
- **target_template:** целевой Template, декодированный из base64 в бинарную строку.
- **target_template_size:** размер строки целевого Template.
- **tmp_array:** массив бинарных строк Template, декодированных из `templates`.
- **tmp_size_array:** размер массива бинарных строк Template.
- **templates_count:** количество объектов в массиве.
- **proc_timeout:** максимальаня продолжительность процесса идентификации.
- **result_index:** указатель на результат идентификации.

### Метод `verify(target_template, template_in_db)`

Аргументы:
- **target_template:** Template целевого отпечатка, по которому будет происходить идентификация.
- **template_in_db:** Template, с которым будет сравниваться целевой отпечаток.

Реализуется метод `ufm_lib.UFM_Verify()`. В качестве аргументов передаются:
- **h_matcher:** атрибут объекта класса `FingerMatcher`.
- **target_template:** целевой Template, декодированный из base64 в бинарную строку.
- **target_template_size:** размер строки целевого Template.
- **template_in_db:** сравниваемый с целевым Template, декодированный из base64 в бинарную строку.
- **template_size_in_db:** размер строки целевого Template.
- **result_index:** указатель на результат верификации.